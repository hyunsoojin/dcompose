name: awsgoo
services:
  # ê²Œì´íŠ¸ì›¨ì´ ì„œë¹„ìŠ¤ (sc-gateway)
  gateway:
    image: jhs7251/sc-gateway:0.4.4 # ë¹Œë“œëœ Docker ì´ë¯¸ì§€ ì´ë¦„
    container_name: gateway
    ports:
      - "9000:9000"
    environment:
      # ğŸ’¡ Compose ë‚´ë¶€ì˜ ë‹¤ë¥¸ ì„œë¹„ìŠ¤ ì´ë¦„ì„ ì‚¬ìš©í•˜ì—¬ URIë¥¼ ì„¤ì •í•©ë‹ˆë‹¤.
      - HELLO_SERVICE_URI=http://hello-service:8080
      - EUREKA_CLIENT_SERVICEURL_DEFAULTZONE=http://eureka:8761/eureka/
    depends_on:
      - hello-service
      - eureka

  # íƒ€ê²Ÿ ì„œë¹„ìŠ¤ (hello-service)
  hello-service:
    image: jhs7251/inspire-simple-spring:0.3.1
    ports:
      - "8765:8080" # ì™¸ë¶€ë¡œ 8765 í¬íŠ¸ ë…¸ì¶œ (ì„ íƒ ì‚¬í•­)
    # Compose ë‚´ë¶€ì—ì„œëŠ” ì„œë¹„ìŠ¤ ì´ë¦„(hello-service)ì´ DNS ì—­í• ì„ í•©ë‹ˆë‹¤.
  eureka:
    image: jhs7251/eureka-serv:0.2.1
    container_name: eureka
    ports:
      - "8761:8761"
  user-service:
    image: jhs7251/user-service:0.2.0
    expose:
      - "9002"
    environment:
      - EUREKA_CLIENT_SERVICEURL_DEFAULTZONE=http://eureka:8761/eureka/
      - SPRING_APPLICATION_NAME=user-service
      - CPU_STRESS_NUMBER=500
      - LOGGING_LEVEL_ROOT=INFO
      - LOGGING_LEVEL_COM_EXAMPLE_USER_SERVICE=DEBUG # ì‚¬ìš©ì íŒ¨í‚¤ì§€ë¥¼ DEBUGë¡œ ì„¤ì •
      - LOGGING_LEVEL_ORG_SPRINGFRAMEWORK_WEB=DEBUG  # Spring Web ê´€ë ¨ ë¡œê·¸ë¥¼ ìƒì„¸íˆ ë³´ê³  ì‹¶ì„ ë•Œ ì¶”ê°€
    deploy:
      mode: replicated
      replicas: 5
      resources: # https://docs.docker.com/compose/compose-file/compose-file-v3/#resources
        limits:
          cpus: '0.1'
          memory: 300M
        reservations:
          cpus: '0.01'
          memory: 250M

    depends_on:
      eureka:
        condition: service_started
  controller:
    image: ngrinder/controller:3.5.8
    platform: linux/amd64
    restart: always
    ports:
      - "8300:80"
      - "16001:16001"
      - "12000-12009:12000-12009"
    volumes:
      - ./ngrinder-controller:/opt/ngrinder-controller
  agent:
    image: ngrinder/agent:3.5.8
    platform: linux/amd64
    restart: always
    links:
      - controller
