services:
  # 게이트웨이 서비스 (sc-gateway)
  gateway:
    image: jhs7251/sc-gateway:0.4.3 # 빌드된 Docker 이미지 이름
    ports:
      - "9000:9000"
    environment:
      # 💡 Compose 내부의 다른 서비스 이름을 사용하여 URI를 설정합니다.
      - HELLO_SERVICE_URI=http://hello-service:8080
      - EUREKA_CLIENT_SERVICEURL_DEFAULTZONE=http://eureka:8761/eureka/
    depends_on:
      - hello-service
      - eureka
    networks:
      - my-network

  # 타겟 서비스 (hello-service)
  hello-service:
    image: jhs7251/inspire-simple-spring:0.3.1
    ports:
      - "8765:8080" # 외부로 8765 포트 노출 (선택 사항)
    networks:
      - my-network
    # Compose 내부에서는 서비스 이름(hello-service)이 DNS 역할을 합니다.
  eureka:
    image: jhs7251/eureka-serv:0.2.1
    ports:
      - "8761:8761"
    networks:
      - my-network
  user-service:
    image: jhs7251/user-service:0.1.0
    expose:
      - "9002"
    environment:
      - EUREKA_CLIENT_SERVICEURL_DEFAULTZONE=http://eureka:8761/eureka/
      - SPRING_APPLICATION_NAME=user-service
    deploy:
      mode: replicated
      replicas: 5
    depends_on:
      eureka:
        condition: service_started
    networks:
      - my-network
networks:
  my-network:
    driver: bridge
